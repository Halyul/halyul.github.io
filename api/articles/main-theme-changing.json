{"title":"实现主站静态主题更换后，Android手机状态栏随同变色功能","slug":"main-theme-changing","date":"2016-12-31T10:58:00.000Z","updated":"2016-12-31T13:20:38.000Z","comments":true,"path":"api/articles/main-theme-changing.json","excerpt":"主页都不知道给我换了多少次了，用不上了嗯。","covers":null,"content":"<p>主页都不知道给我换了多少次了，用不上了嗯。</p>\n<a id=\"more\"></a>\n<h2 id=\"缘由\"><a href=\"#缘由\" class=\"headerlink\" title=\"缘由\"></a>缘由</h2><h3 id=\"大背景\"><a href=\"#大背景\" class=\"headerlink\" title=\"大背景\"></a>大背景</h3><p>Android在KitKat时代加入了变色状态栏，而Chrome在版本v39可以通过读取网页中<code>&lt;meta name=&quot;theme-color&quot; content=&quot;#3F51B5&quot;&gt;</code> 这段位于<code>&lt;head&gt;&lt;/head&gt;</code>前的代码实现改变状态栏颜色及地址栏颜色。</p>\n<p>![状态栏变色效果][2]![状态栏变色效果][3]<br>[2]: //img.halyul.com/images/2017/03/15/o_1b7viobs21q6h1b0h1p5v13gf1fmra.png<br>[3]: <a href=\"https://img.halyul.com/images/2017/03/15/o_1b7vioo0s1re04bb1ld73hfgr6a.png\" target=\"_blank\" rel=\"noopener\">https://img.halyul.com/images/2017/03/15/o_1b7vioo0s1re04bb1ld73hfgr6a.png</a></p>\n<p>来源：[Chrome v39 On Lollipop Supports Custom Multitasking Header/Status Bar Colors With A Simple HTML Tag - Android Police][4]<br>[4]: <a href=\"http://www.androidpolice.com/2014/11/10/chrome-v39-on-lollipop-supports-custom-multitasking-headerstatus-bar-colors-with-a-simple-html-tag/\" target=\"_blank\" rel=\"noopener\">http://www.androidpolice.com/2014/11/10/chrome-v39-on-lollipop-supports-custom-multitasking-headerstatus-bar-colors-with-a-simple-html-tag/</a></p>\n<h3 id=\"小背景\"><a href=\"#小背景\" class=\"headerlink\" title=\"小背景\"></a>小背景</h3><p>我的[主站][1]网页代码中有以下几段：<br>[1]: //halyul.cc</p>\n<pre class=\"line-numbers language-js\" mdui-tooltip=\"{content: 'js'}\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> jQuery Cookie <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"js/jquery.cookie.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> $<span class=\"token punctuation\">.</span><span class=\"token function\">cookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styleCookie'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">'style-light.css'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html, body'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'background'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#eeeeee'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//用户读取到上次访问时，网站的样式为style-light.css，全站背景为白色</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">.</span><span class=\"token function\">cookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styleCookie'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">'style.css'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html, body'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'background'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#222222'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//用户读取到上次访问时，网站的样式为style.css，全站背景为黑色</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> jQuery Easing <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"js/jquery.easing.1.3.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>这几段是涉及到了主页右上角的主题变换开关——黑白风格的变换。</p>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>而作为Androider我，必须得实现状态栏变色啊！所以各种度娘后，找到了[方法][5]。<br>[5]: <a href=\"https://zhidao.baidu.com/question/936921982308974372.html\" target=\"_blank\" rel=\"noopener\">https://zhidao.baidu.com/question/936921982308974372.html</a></p>\n<p>我在源代码以及找到的方法的基础上，在上面的代码中添加以下代码：</p>\n<pre class=\"line-numbers language-js\" mdui-tooltip=\"{content: 'js'}\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> jQuery Cookie <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"js/jquery.cookie.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> Theme changing <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> $<span class=\"token punctuation\">.</span><span class=\"token function\">cookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styleCookie'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">'style-light.css'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html, body'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'background'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#eeeeee'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//用户读取到上次访问时，网站的样式为style-light.css，全站背景为白色</span>\n        <span class=\"token keyword\">var</span> oMeta <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'meta'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//生成一个新的 &lt;meta>标签</span>\n        oMeta<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'theme-color'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//给该&lt;meta>标签添加 name=\"theme-color\"属性</span>\n        oMeta<span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> <span class=\"token string\">'#eeeeee'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//给该&lt;meta>标签添加 content = \"#eeeeee\"属性，状态栏颜色为白色</span>\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'head'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>oMeta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//将该&lt;meta>标签放置在&lt;head>&lt;/head>前</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">.</span><span class=\"token function\">cookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'styleCookie'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">'style.css'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html, body'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">css</span><span class=\"token punctuation\">(</span><span class=\"token string\">'background'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'#222222'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//用户读取到上次访问时，网站的样式为style.css，全站背景为黑色</span>\n        <span class=\"token keyword\">var</span> oMeta <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'meta'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//生成一个新的 &lt;meta>标签</span>\n        oMeta<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'theme-color'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//给该&lt;meta>标签添加 name=\"theme-color\"属性</span>\n        oMeta<span class=\"token punctuation\">.</span>content <span class=\"token operator\">=</span> <span class=\"token string\">'#222222'</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//给该&lt;meta>标签添加 content = \"#eeeeee\"属性，状态栏颜色为黑色</span>\n        document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'head'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>oMeta<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\" spellcheck=\"true\">//将该&lt;meta>标签放置在&lt;head>&lt;/head>前</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> jQuery Easing <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"js/jquery.easing.1.3.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>其中<code>oMeta</code>为变量，可以任意修改。</p>\n</blockquote>\n<p>** 由于Chrome每次加载只读取一次<code>&lt;meta&gt;</code>标签，所以更换主题后状态栏颜色必须刷新页面才能生效。**</p>\n<p>然后就完成啦~</p>\n<blockquote>\n<p>然而这个东西卡了我3天。。。之前没有思路，甚至还将主站的主题变换功能去掉了。。。但现在终究是完成了~</p>\n</blockquote>\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p>用户再次访问网站后，即可实现状态栏变色。</p>\n<p>![状态栏变色效果][6]![状态栏变色效果][7]<br>[6]: <a href=\"https://img.halyul.com/images/2017/03/15/o_1b7vip7o71i9710d6kofcs482a.png\" target=\"_blank\" rel=\"noopener\">https://img.halyul.com/images/2017/03/15/o_1b7vip7o71i9710d6kofcs482a.png</a><br>[7]: <a href=\"https://img.halyul.com/images/2017/03/15/o_1b7vipr5g4g3tnig521disqh8a.png\" target=\"_blank\" rel=\"noopener\">https://img.halyul.com/images/2017/03/15/o_1b7vipr5g4g3tnig521disqh8a.png</a></p>\n<p>从源代码也可以看到在</p>\n<pre class=\"line-numbers language-js\" mdui-tooltip=\"{content: 'js'}\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> jQuery Easing <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"js/jquery.easing.1.3.js\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>后多了一行黑色状态栏的代码</p>\n<pre class=\"line-numbers language-html\" mdui-tooltip=\"{content: 'html'}\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>theme-color<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>#222222<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>或是白色状态栏的代码</p>\n<pre class=\"line-numbers language-html\" mdui-tooltip=\"{content: 'html'}\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>theme-color<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>#eeeeee<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n","categories":[{"name":"技术","path":"api/categories/技术.json"}],"tags":[{"name":"Android","path":"api/tags/Android.json"}]}