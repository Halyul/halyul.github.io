{"title":"失踪人口回归系列之在VPS上搭建HEXO的GIT部署环境","slug":"vps-hexo","date":"2017-03-22T09:53:00.000Z","updated":"2017-11-25T09:58:00.000Z","comments":true,"path":"api/articles/vps-hexo.json","excerpt":"失踪人口回归系列之第一篇<br>","covers":null,"content":"<p>失踪人口回归系列之第一篇<br><a id=\"more\"></a></p>\n<h2 id=\"写在开头\"><a href=\"#写在开头\" class=\"headerlink\" title=\"写在开头\"></a>写在开头</h2><p>由于HEXO是静态博客，越来越多的人选择在GitHub, Coding等Pages服务提供商处搭建自己的博客，从而省下买网页空间或VPS的钱。</p>\n<p>然而有部分人会选择在VPS上使用HEXO，但是却发现远不如使用Pages服务方便，但看完这篇文章，你就会发现，这并没有想象中那么<del>方便</del>难。</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><ul>\n<li><del>一台电脑</del></li>\n<li><del>一台VPS</del></li>\n<li><del>一个打开本页面的浏览器</del></li>\n</ul>\n<h3 id=\"本地环境\"><a href=\"#本地环境\" class=\"headerlink\" title=\"本地环境\"></a>本地环境</h3><h4 id=\"现在本地上安装Node-js和git\"><a href=\"#现在本地上安装Node-js和git\" class=\"headerlink\" title=\"现在本地上安装Node.js和git\"></a>现在本地上安装Node.js和git</h4><p>请访问<a href=\"https://nodejs.org/en/download/package-manager/\" target=\"_blank\" rel=\"noopener\">Installing Node.js via package manager</a>，安装你系统的对应版本。</p>\n<h4 id=\"安装Hexo\"><a href=\"#安装Hexo\" class=\"headerlink\" title=\"安装Hexo\"></a>安装Hexo</h4><pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i -g hexo-cli\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<blockquote>\n<p>如果你有<code>cnpm</code>, 只需要将<code>npm</code>替换成<code>cnpm</code></p>\n</blockquote>\n<h4 id=\"创建Hexo\"><a href=\"#创建Hexo\" class=\"headerlink\" title=\"创建Hexo\"></a>创建Hexo</h4><pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> /path/to/hexo\n$ <span class=\"token function\">cd</span> /path/to/hexo\n$ hexo init\n$ hexo s\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>其中<code>/path/to/hexo</code>为你想要存放Hexo数据的地方</p>\n</blockquote>\n<p>如果<code>hexo init</code>过程中安装终端，请执行</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">cd</span> /path/to/hexo\n$ <span class=\"token function\">npm</span> i\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>打开<a href=\"localhost:4000\" target=\"_blank\" rel=\"noopener\">localhost:4000</a>, 如若看见Hexo初始页面则Hexo安装成功。</p>\n<h4 id=\"生成SSH公钥密钥\"><a href=\"#生成SSH公钥密钥\" class=\"headerlink\" title=\"生成SSH公钥密钥\"></a>生成SSH公钥密钥</h4><blockquote>\n<p>由于我曾经进过此步发现并没有什么用，故而以下内容皆为引用自<a href=\"https://blog.viosey.com/2016/10/05/hexo-vps-git/#生成-SSH-公钥密钥\" target=\"_blank\" rel=\"noopener\">Viosey</a>。<br>经实测此步可忽略，区别在于<code>hexo d</code>过程是否需要输入密码。</p>\n</blockquote>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">cd</span> ~/.ssh\n$ ssh-keygen\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>它先要求你确认保存公钥的位置（.ssh/id_rsa），然后它会让你重复一个密码两次，如果不想在使用公钥的时候输入密码，可以留空。</p>\n<p><a href=\"https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/\" target=\"_blank\" rel=\"noopener\">GitHub Help - Generating a new SSH key and adding it to the ssh-agent</a></p>\n<h3 id=\"服务器环境\"><a href=\"#服务器环境\" class=\"headerlink\" title=\"服务器环境\"></a>服务器环境</h3><h4 id=\"安装Git-amp-Node-js\"><a href=\"#安装Git-amp-Node-js\" class=\"headerlink\" title=\"安装Git &amp; Node.js\"></a>安装Git &amp; Node.js</h4><h5 id=\"Ubuntu\"><a href=\"#Ubuntu\" class=\"headerlink\" title=\"Ubuntu\"></a>Ubuntu</h5><pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token function\">git</span>\n$ curl -sL https://deb.nodesource.com/setup_6.x <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> -E <span class=\"token function\">bash</span> -\n$ <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> -y nodejs\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>此为 Node.js v6</p>\n<p>若想安装其他版本，请更改为<br>Node.js v7</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ curl -sL https://deb.nodesource.com/setup_7.x <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> -E <span class=\"token function\">bash</span> -\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h5 id=\"CentOS\"><a href=\"#CentOS\" class=\"headerlink\" title=\"CentOS\"></a>CentOS</h5><pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ curl -sL https://rpm.nodesource.com/setup <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> -\n$ yum <span class=\"token function\">install</span> -y nodejs\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>此为 Node.js 0.10</p>\n<p>若想安装其他版本，请更改为<br>Node.js v7</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ curl --silent --location https://rpm.nodesource.com/setup_7.x <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> -\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>Node.js v6 LTS</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ curl --silent --location https://rpm.nodesource.com/setup_6.x <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> -\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"创建-git-用户-amp-禁用-git-用户的-shell-登录权限\"><a href=\"#创建-git-用户-amp-禁用-git-用户的-shell-登录权限\" class=\"headerlink\" title=\"创建 git 用户 &amp; 禁用 git 用户的 shell 登录权限\"></a>创建 git 用户 &amp; 禁用 git 用户的 shell 登录权限</h4><pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ adduser <span class=\"token function\">git</span>\n$ vim /etc/passwd\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>将</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">git:x:1001:1001:,,,:/home/git:/bin/bash\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>改为</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"添加证书登录\"><a href=\"#添加证书登录\" class=\"headerlink\" title=\"添加证书登录\"></a>添加证书登录</h4><h5 id=\"已生成公钥\"><a href=\"#已生成公钥\" class=\"headerlink\" title=\"已生成公钥\"></a>已生成公钥</h5><p>把<code>.pub</code>公钥里的内容添加到服务器的<code>/home/git/.ssh/authorized_keys</code>文件中</p>\n<h5 id=\"未生成公钥\"><a href=\"#未生成公钥\" class=\"headerlink\" title=\"未生成公钥\"></a>未生成公钥</h5><p>请执行在服务器端执行</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">passwd</span> <span class=\"token function\">git</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>更改git的密码。</p>\n<h4 id=\"建立git仓库\"><a href=\"#建立git仓库\" class=\"headerlink\" title=\"建立git仓库\"></a>建立git仓库</h4><pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> /path/to/repo\n$ <span class=\"token function\">cd</span> /path/to/repo\n$ <span class=\"token function\">git</span> init --bare hexo.git\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>目录可自行选择。<br>eg.</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> /home/git/repos\n$ <span class=\"token function\">cd</span> /home/git/repos\n$ <span class=\"token function\">git</span> init --bare hexo.git\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>然后在<code>/home/git/repos</code>下会有一个<code>hexo.git</code>的文件夹</p>\n<blockquote>\n<p>使用 –bare 参数，Git 就会创建一个裸仓库，裸仓库没有工作区，我们不会在裸仓库上进行操作，它只为共享而存在。</p>\n</blockquote>\n<h4 id=\"配置git-hooks\"><a href=\"#配置git-hooks\" class=\"headerlink\" title=\"配置git hooks\"></a>配置git hooks</h4><p>在<code>hexo.git/hooks</code>目录下，执行</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">cd</span> /path/to/hexo.git/hooks\n$ <span class=\"token function\">nano</span> post-receive\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<blockquote>\n<p>你可以选择自己熟手的编辑器新建这个<code>post-receive</code></p>\n</blockquote>\n<p>在<code>post-receive</code>中写入如下内容:</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token function\">git</span> --work-tree<span class=\"token operator\">=</span>/path/to/your/site --git-dir<span class=\"token operator\">=</span>/path/to/hexo.git checkout -f\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>其中<code>/path/to/your/site</code>为你的站点文件夹，<code>/path/to/hexo.git</code>为你所建立<code>hexo.git</code>的完整路径</p>\n<p>eg.</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token function\">git</span> --work-tree<span class=\"token operator\">=</span>/var/www/blog.halyul.com --git-dir<span class=\"token operator\">=</span>/home/git/repos/hexo.git checkout -f\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>设置<code>post-receive</code>的可执行权限</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">chmod</span> +x post-receive\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h4 id=\"设置目录拥有者\"><a href=\"#设置目录拥有者\" class=\"headerlink\" title=\"设置目录拥有者\"></a>设置目录拥有者</h4><pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">chown</span> -hR git:git /path/to/hexo.git\n$ <span class=\"token function\">chown</span> -hR git:git /path/to/your/site\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h2 id=\"本地Hexo配置\"><a href=\"#本地Hexo配置\" class=\"headerlink\" title=\"本地Hexo配置\"></a>本地Hexo配置</h2><p>先安装<code>hexo-deployer-git</code>以执行hexo的git部署</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i --save hexo-deployer-git\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>打开hexo目录下的<code>_config.yml</code>，找到<code>deploy</code>进行修改</p>\n<pre class=\"line-numbers language-yaml\" mdui-tooltip=\"{content: 'yaml'}\"><code class=\"language-yaml\"><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> git\n    <span class=\"token key atrule\">repo</span><span class=\"token punctuation\">:</span> git@example.com<span class=\"token punctuation\">:</span>hexo.git\n    <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p>其中<code>example.com</code>为你的站点地址或IP</p>\n</blockquote>\n<h2 id=\"开始使用\"><a href=\"#开始使用\" class=\"headerlink\" title=\"开始使用\"></a>开始使用</h2><p>当你需要生成以及部署hexo时，运行</p>\n<pre class=\"line-numbers language-bash\" mdui-tooltip=\"{content: 'bash'}\"><code class=\"language-bash\">$ hexo clean <span class=\"token operator\">&amp;&amp;</span> hexo d\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p><strong>大功告成~</strong></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://blog.viosey.com/2016/10/05/hexo-vps-git/\" target=\"_blank\" rel=\"noopener\">在 VPS 上搭建 Hexo 博客，使用 Git 部署</a></p>\n","categories":[{"name":"技术","path":"api/categories/技术.json"}],"tags":[{"name":"Hexo","path":"api/tags/Hexo.json"},{"name":"教程","path":"api/tags/教程.json"}]}